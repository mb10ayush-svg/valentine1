<script>
  // ===== SETTINGS =====
  const CORRECT_PASSWORD = "251225";

  // ---------- UNLOCK ----------
  function unlock() {
    const passInput = document.getElementById("password");
    const lock = document.getElementById("lock");
    const main = document.getElementById("main");
    const music = document.getElementById("music");

    if (!passInput || !lock || !main) return;

    if (passInput.value === CORRECT_PASSWORD) {
      lock.style.display = "none";
      main.style.display = "block";
      if (music) music.play();
    } else {
      alert("Wrong password üòú");
    }
  }

  // ---------- SLIDESHOW ----------
  const photos = ["photo1.jpg", "photo2.jpg", "photo3.jpg"];
  let i = 0;

  const slideImg = document.getElementById("slide");
  if (slideImg) {
    setInterval(() => {
      i = (i + 1) % photos.length;
      slideImg.src = photos[i];
    }, 2500);
  }

  // ---------- YES BUTTON ----------
  const yesBtn = document.getElementById("yesBtn");
  if (yesBtn) {
    yesBtn.onclick = () => {
      startConfetti();

      const main = document.getElementById("main");
      if (!main) return;

      main.innerHTML = `
        <div id="memory">
          <h1 class="glow">Aishwarya üíñ</h1>

          <div id="typing"
            style="margin:10px 0 15px;
            font-size:20px;
            color:#ffb3c6;
            min-height:28px;
            letter-spacing:1px;">
          </div>

          <p>
            This is my little secret for you.<br><br>
            You make my heart smile in ways I never expected.<br>
            I want to remember this moment forever ‚ù§Ô∏è
          </p>

          <button class="pink" onclick="saveMemory()">Save This Moment üì∏</button>
        </div>
      `;

      typeLove();
    };
  }

  // ---------- TYPING EFFECT ----------
  const text = "I love you ‚ù§Ô∏è";
  function typeLove() {
    const el = document.getElementById("typing");
    if (!el) return;

    let t = 0;
    el.innerHTML = "";

    const timer = setInterval(() => {
      el.innerHTML += text.charAt(t);
      t++;
      if (t === text.length) {
        clearInterval(timer);
        setTimeout(typeLove, 1800);
      }
    }, 120);
  }

  // ---------- SCREENSHOT ----------
  function saveMemory() {
    const memory = document.getElementById("memory");
    if (!memory || typeof html2canvas === "undefined") return;

    html2canvas(memory).then(canvas => {
      const link = document.createElement("a");
      link.download = "Aishwarya_Valentine_Memory.png";
      link.href = canvas.toDataURL();
      link.click();
    });
  }

  // ---------- NO BUTTON ESCAPE ----------
  const noBtn = document.getElementById("noBtn");
  if (noBtn) {
    noBtn.onmouseover = () => {
      noBtn.style.left = Math.random() * 80 + "vw";
      noBtn.style.top = Math.random() * 80 + "vh";
    };
  }

  // ---------- FLOATING HEARTS ----------
  setInterval(() => {
    const h = document.createElement("div");
    h.className = "heart";
    h.innerHTML = "‚ù§Ô∏è";
    h.style.left = Math.random() * 100 + "vw";
    document.body.appendChild(h);
    setTimeout(() => h.remove(), 5000);
  }, 400);

  // ---------- CONFETTI ----------
  const canvas = document.getElementById("confetti");
  let ctx = null;
  let confetti = [];

  if (canvas) {
    ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }

  function startConfetti() {
    if (!ctx) return;

    confetti = [];
    for (let i = 0; i < 160; i++) {
      confetti.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height - canvas.height,
        r: Math.random() * 6 + 4,
        color: `hsl(${Math.random() * 360},100%,70%)`
      });
    }
    requestAnimationFrame(drawConfetti);
  }

  function drawConfetti() {
    if (!ctx) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    confetti.forEach((c, i) => {
      ctx.beginPath();
      ctx.fillStyle = c.color;
      ctx.arc(c.x, c.y, c.r, 0, Math.PI * 2);
      ctx.fill();
      c.y += 4;
      if (c.y > canvas.height) confetti.splice(i, 1);
    });
    if (confetti.length) requestAnimationFrame(drawConfetti);
  }
</script>
